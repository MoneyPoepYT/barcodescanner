<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Barcode Scanner</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader-bundle@10.4.3100/dist/dbr.bundle.js"></script>
</head>
<body>
  <header>
    <a href="barcodes.html">âž• Ga naar opgeslagen barcodes</a>
  </header>
  <h2>Scan een barcode</h2>
  <div id="camera-view-container" style="width: 100%; height: 100vh;"></div>
  <pre id="results"></pre>

  <script>
    (async () => {
      // Initialiseer Dynamsoft
      Dynamsoft.License.LicenseManager.initLicense("DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9");

      const cvRouter = await Dynamsoft.CVR.CaptureVisionRouter.createInstance();
      const cameraView = await Dynamsoft.DCE.CameraView.createInstance();
      const cameraEnhancer = await Dynamsoft.DCE.CameraEnhancer.createInstance(cameraView);
      document.getElementById("camera-view-container").appendChild(cameraView.getUIElement());

      cvRouter.setInput(cameraEnhancer);

      const resultsContainer = document.getElementById("results");

      const resultReceiver = new Dynamsoft.CVR.CapturedResultReceiver();
      resultReceiver.onCapturedResultReceived = (result) => {
        if (result.barcodeResultItems?.length) {
          const code = result.barcodeResultItems[0].text;
          const format = result.barcodeResultItems[0].formatString;

          resultsContainer.textContent = `${format}: ${code}`;

          // ðŸ‘‰ Laad de opgeslagen berichten uit localStorage
          const barcodes = JSON.parse(localStorage.getItem("barcodes")) || [];
          const entry = barcodes.find(b => b.code === code);

          if (entry && entry.message) {
            alert("ðŸ“¢ Bericht: " + entry.message);
          } else {
            alert("Geen bericht gevonden voor deze barcode.");
          }
        }
      };
      cvRouter.addResultReceiver(resultReceiver);

      await cameraEnhancer.open();
      await cvRouter.startCapturing("ReadSingleBarcode");
    })();
  </script>
</body>
</html>
